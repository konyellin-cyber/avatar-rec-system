# 下一步计划

## 待验证问题清单

### 第一层：快速记忆检索

#### Q1: 触发时机
- [ ] 每次对话开始时自动检索？
- [ ] 还是用户问到时再去检索？
- [ ] 用户偏好？成本权衡？

#### Q2: Token 预算和速度
- [ ] Token 预算: < 1000 tokens？还是可以更宽松？
- [ ] 速度要求: < 2 秒？还是 < 5 秒也可接受？
- [ ] 这两个约束中，哪个更重要？

#### Q3: 输出形式
- [ ] 直接注入到 Context Window？
- [ ] 还是先给用户看，用户选择要不要用？
- [ ] 可见性 vs 自动化的权衡？

#### Q4: 召回策略优化
- [ ] 四路召回的权重如何调整？
  - 时间路径：0.3
  - 标签路径：0.4
  - 文件路径：0.3
  - 文本搜索：单独处理？
- [ ] 是否需要根据 Query 类型动态调整权重？
- [ ] 如何处理"找不到相关记忆"的情况？
  - 返回最近记忆？
  - 返回空？
  - 触发第二层？

---

### 第二层：海量知识检索

#### Q5: 数据源定义
- [ ] "海量发表数据"具体指什么？
  - ArXiv 论文？
  - 网页搜索（Google/Bing）？
  - iSearch 内网文档？
  - 社交讨论（小红书/微博/知乎）？
- [ ] 各数据源的权重如何分配？
- [ ] 哪些数据源优先接入？

#### Q6: 触发条件
- [ ] 什么情况下触发第二层？
  - 第一层检索不到有用信息？
  - 用户明确要求深度回答（如"帮我深入研究一下"）？
  - 检测到复杂问题（需要外部知识支撑）？
  - 还是每次都执行，只是后台慢慢做？
- [ ] 如何让用户知道"第二层正在工作"？
  - 显示进度？
  - 先返回第一层结果，后续补充？

#### Q7: 评价标准
- [ ] "更好的回答"指的是？
  - 更全面（覆盖更多信息源）？
  - 更深刻（结合外部知识的洞察）？
  - 更可信（有引用和来源）？
  - 更实用（可执行的建议）？
- [ ] 如何量化这些标准？
- [ ] 用户如何评价回答质量？

#### Q8: Query Tower 复杂度
- [ ] 全程 LLM（理解能力强，但慢且贵）？
- [ ] 轻量模型（快，但理解能力弱）？
- [ ] 混合方案（简单 Query 用轻量模型，复杂 Query 用 LLM）？
- [ ] 延迟和成本如何平衡？
  - 可接受的延迟上限？
  - 可接受的成本上限？

---

### 整体架构

#### Q9: 两层交互
- [ ] 第一层失败时如何优雅降级到第二层？
  - 自动触发？
  - 询问用户？
- [ ] 第二层结果如何反哺第一层（记忆更新）？
  - 自动记录到 memory？
  - 用户确认后记录？

#### Q10: 冷启动
- [ ] 新用户/新话题时的兜底策略？
  - 通用模板？
  - 主动询问收集信息？
- [ ] 如何快速建立初始记忆？
  - 引导式对话？
  - 导入外部数据（如笔记/文档）？

#### Q11: 业务迁移
- [ ] 能否应用到公众号推荐的创作者理解场景？
  - 哪些部分可以复用？
  - 哪些需要重新设计？
- [ ] 迁移的价值有多大？
  - 值得投入资源吗？
  - ROI 预估？

---

## 实现路线图

### Phase 1: 第一层原型（当前优先级）

**目标**: 验证规则召回的有效性

**任务清单**:
- [ ] 实现四路召回逻辑
  - [ ] 时间路径（最近 3 天日志）
  - [ ] 标签路径（关键词 → 标签映射）
  - [ ] 文件路径（insights.md / projects.md 优先）
  - [ ] 文本搜索（ripgrep 全文检索）
- [ ] 实现轻量排序算法
  - [ ] 加权打分公式
  - [ ] Top-K 选择
  - [ ] Token 限制
- [ ] 集成到对话流程
  - [ ] 触发时机决策
  - [ ] 结果注入方式
- [ ] 测试与优化
  - [ ] 准确率测试（用户主观评价）
  - [ ] 速度测试（<2秒）
  - [ ] Token 效率测试（<1000）
- [ ] 收集用户反馈
  - [ ] 召回是否相关？
  - [ ] 是否有遗漏？
  - [ ] Token 消耗是否可接受？

**成功标准**:
- 召回准确率 > 80%（用户认为相关）
- 延迟 < 2 秒
- Token 消耗 < 1000
- 用户满意度 > 75%

**预计时间**: 2-3 周

---

### Phase 2: 第二层设计

**目标**: 明确数据源和触发条件

**任务清单**:
- [ ] 明确"海量数据"的具体定义
  - [ ] 列出候选数据源
  - [ ] 评估接入难度
  - [ ] 优先级排序
- [ ] 设计触发条件和用户交互
  - [ ] 什么情况触发？
  - [ ] 如何告知用户？
  - [ ] 如何展示结果？
- [ ] 技术选型
  - [ ] 是否需要训练双塔模型？
  - [ ] 还是用现成的向量模型（如 OpenAI Embeddings）？
  - [ ] LLM 精排的提示词设计
- [ ] 原型实现
  - [ ] 接入第一个数据源（如 ArXiv）
  - [ ] 实现双塔召回
  - [ ] 实现 LLM 精排
- [ ] 测试与优化
  - [ ] 回答深度评估
  - [ ] 引用来源可信度
  - [ ] 延迟是否可接受
- [ ] 收集用户反馈
  - [ ] 是否真的"更好"？
  - [ ] 是否值得等待？
  - [ ] 是否有价值？

**成功标准**:
- 回答深度显著提升（用户主观评价 > 80%）
- 引用来源可信
- 延迟可接受（<30秒）
- 用户认为值得等待（> 70%）

**预计时间**: 4-6 周

---

### Phase 3: 主动对话

**目标**: 基于记忆主动发起讨论

**任务清单**:
- [ ] 设计主动对话的时机选择算法
  - [ ] 什么时候主动说话？
  - [ ] 如何避免打扰？
  - [ ] 如何判断话题价值？
- [ ] 实现话题推荐逻辑
  - [ ] 基于记忆发现关联
  - [ ] 基于时间推断可能关心的议题
  - [ ] 基于用户画像预测兴趣
- [ ] 用户接受度测试
  - [ ] 主动对话被接受率
  - [ ] 用户反馈（打扰 vs 有价值）
  - [ ] 频率调整
- [ ] 迭代优化
  - [ ] 根据反馈调整时机
  - [ ] 根据反馈调整话题选择
  - [ ] 根据反馈调整表达方式

**成功标准**:
- 主动对话被接受率 > 60%
- 用户认为"有价值"的比例 > 80%
- 用户主动分享增加（正向飞轮启动）

**预计时间**: 6-8 周

---

## 资源需求

### 人力
- 1 人（用户 plancklin）
- 1 个分身 Agent（林风过竹）

### 技术栈
- OpenClaw（已有）
- Git（记忆同步，已配置）
- LLM（工蜂 AI，已接入）
- ripgrep（文本搜索，需安装？）
- 双塔模型（Phase 2，待选型）

### 数据源
- 个人记忆（已有，~千级）
- 外部知识库（Phase 2，待接入）

### 基础设施
- GitHub 仓库（已创建）
- 开发环境（OpenClaw workspace，已配置）

---

## 风险与挑战

### 技术风险
1. **第一层召回准确率不足**
   - 缓解：多轮迭代，收集反馈
2. **Token 成本超预期**
   - 缓解：严格控制，优化策略
3. **第二层延迟过高**
   - 缓解：异步处理，先返回部分结果

### 产品风险
1. **用户不需要主动对话**
   - 缓解：可选功能，默认关闭
2. **记忆自动化不可信**
   - 缓解：人工确认机制
3. **隐私担忧**
   - 缓解：本地存储，用户完全控制

### 业务风险
1. **迁移价值不明确**
   - 缓解：先验证个人场景，再考虑业务迁移
2. **ROI 不足**
   - 缓解：控制投入，快速验证

---

## 关键里程碑

### Milestone 1: 第一层原型可用（2-3 周）
- 四路召回实现
- 集成到对话流程
- 用户可以实际使用

### Milestone 2: 第二层设计完成（4-6 周）
- 数据源明确
- 技术方案确定
- 原型可演示

### Milestone 3: 主动对话初版（6-8 周）
- 时机选择算法实现
- 用户接受度验证
- 正向飞轮启动

### Milestone 4: 业务迁移评估（8-12 周）
- 个人场景验证成功
- 迁移方案设计完成
- ROI 评估报告

---

## 成功指标

### 定量指标
- 第一层召回准确率 > 80%
- 第一层延迟 < 2 秒
- 第一层 Token 消耗 < 1000
- 第二层回答深度提升 > 50%（用户评价）
- 第二层延迟 < 30 秒
- 主动对话接受率 > 60%
- 用户主动分享增加 > 30%

### 定性指标
- 用户认为"分身真的懂我"
- 用户愿意主动分享更多信息
- 用户觉得"分身是思考伙伴，不只是工具"
- 用户会推荐给其他人

---

## 下一步行动

**立即行动**（本周）:
1. [ ] 回答 Q1-Q4（第一层的关键问题）
2. [ ] 开始实现第一路召回（时间路径）
3. [ ] 搭建测试框架

**近期行动**（2 周内）:
1. [ ] 完成四路召回实现
2. [ ] 集成到对话流程
3. [ ] 开始用户测试

**中期行动**（1 个月内）:
1. [ ] 优化第一层
2. [ ] 开始第二层设计
3. [ ] 明确数据源

---

_"一步一步来，先把第一层做好。" - 项目原则_
