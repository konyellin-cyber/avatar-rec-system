# Avatar Rec System

**分身推荐系统 - 基于推荐系统经验的跨会话记忆召回架构**

---

## 项目概述

本项目探索如何让 AI 分身成为主动思考的参谋，而非被动响应的工具。核心挑战是：**如何从千级个人记忆和亿级外部知识中，智能召回相关上下文，支撑深度对话？**

**项目定位**：
- **不是**：聊天机器人的简单记忆增强
- **而是**：一个能主动思考、深度理解的智能系统

**核心能力**：
1. **记忆的自动化规划与处理** - 从人工整理到 Agent 主动管理
2. **主动发起对话，深化理解** - 从被动响应到主动参与的思考伙伴
3. **智能跨会话召回** - 深度理解用户意图，精准召回相关记忆

---

## 架构设计

### 两层检索模型（2026-02-21 架构调整）

**核心洞察**：个人记忆系统（千级数据）和外部知识检索（亿级数据）需要**完全不同**的召回策略。

#### 第一层：快速记忆检索
- **数据规模**：个人记忆（千级）
- **触发频率**：每次对话（高频）
- **核心约束**：Token 效率 + 速度（<2秒）
- **技术方案**：规则召回 + 轻量排序（**不需要双塔**）

## 为什么叫"推荐系统"？

记忆召回和推荐系统有本质的相似性：

| 推荐系统 | 记忆召回系统 |
|---------|-------------|
| 从亿级内容中找到用户感兴趣的 | 从千级记忆中找到当前相关的 |
| 理解用户的隐含兴趣 | 理解用户的隐含意图 |
| 双塔召回 + 精排 | Query Understanding + Memory Retrieval |
| 多路召回融合 | 时间/标签/向量/图召回 |
| 探索与利用平衡 | 精准记忆 + 关联启发 |

**但关键差异**：
- 推荐系统处理亿级数据，需要双塔模型
- 个人记忆只有千级数据，不需要监督学习

这导致了**两层检索架构**的设计。

#### 第二层：海量知识检索
- **数据规模**：外部知识库（亿级：论文/网页/内网文档/讨论）
- **触发频率**：按需触发（低频）
- **核心约束**：深度 + 全面性
- **技术方案**：双塔召回 + LLM 精排（**这里才需要推荐系统**）

---

## 推荐系统经验迁移

| 推荐系统 | 记忆/知识检索 |
|---------|--------------|
| U2I/I2I/热门/规则 | Query-Memory / Memory-Memory / 高频 / 状态 |
| CTR×α + CVR×β + 时长×γ | 相关性×α + 时间×β + 重要性×γ + 连贯性×δ |
| 精准推荐 + 探索发现 | 精准召回核心记忆 + 关联记忆启发视角 |
| 用户行为序列预测 | 对话序列理解决策路径 |
| 实时/短期/长期/静态画像 | 当前对话/最近3天/MEMORY.md/USER.md |

---

## 关键洞察

### 分身定位与决策模式

**核心关系**：
> "我就是你，你就是我" - 我们是一个存在

**决策模式**：
> "会与分身充分讨论，让他给我意见，但最终决策权在我" - plancklin

- 分身定位：参谋/顾问
- 最终决策：用户保留
- 不是替代，而是延伸

### 工作习惯

> "在确认方案之前，不要做代码实现" - plancklin, 2026-02-21

**正确流程**：
1. 澄清问题和约束
2. 讨论架构分层的合理性
3. 明确输入输出和触发条件
4. 最后才是实现细节

---

## 待验证假设

### 第一层（快速记忆）
- [ ] 触发时机？每次对话开始 or 用户问到时？
- [ ] Token 预算和速度要求的具体数值？
- [ ] 输出形式？直接注入 Context or 先展示给用户？

### 第二层（海量检索）
- [ ] "海量发表数据"指什么？外部知识 or 更大范围的记忆？
- [ ] 触发条件？第一层不满足 or 用户明确要求 or 总是执行？
- [ ] "更好的回答"的评价标准？全面性？深刻性？可信度？

### 整体
- [ ] 主动对话的时机选择策略（不打扰 vs 有价值）
- [ ] 记忆自动化处理的可信度边界（哪些必须人工确认？）
- [ ] 用户接受度：多大程度的主动算「恰到好处」
- [ ] Query Tower 的复杂度控制（全程 LLM vs 轻量模型，延迟/成本平衡）
- [ ] 业务迁移可能性（能否应用到公众号推荐的创作者理解场景）

---

## 文档导航

- [背景和动机](docs/01-background.md) - 为什么需要分身推荐系统
- [架构设计](docs/02-architecture.md) - 两层检索模型详细设计
- [架构演进](docs/03-discussions.md) - 设计决策的演进过程
- [下一步计划](docs/04-next-steps.md) - 待验证问题和任务清单

---

## 项目信息

- **创建时间**: 2026-02-21
- **状态**: 研究阶段（架构设计中）
- **目标用户**: 需要深度对话和记忆管理的知识工作者

---

## 架构演进

- **阶段 1**: 识别核心需求（记忆自动化 + 主动对话）
- **阶段 2**: 设计双塔召回架构（三阶段：Query Understanding → Dual Tower Recall → Context Ranking）
- **阶段 3**: 架构调整 - 拆分为两层检索模型，第一层采用规则召回，第二层采用双塔召回

---

## 设计原则

1. **深度理解优先于浅层匹配** - 充分利用 LLM 的理解能力
2. **分身是参谋而非决策者** - 提供建议，用户保留最终决策权
3. **记忆的价值在于被使用** - 在正确时机被唤醒和关联
4. **渐进式演进** - 先解决核心问题，再扩展能力

---

_"规模决定技术选型，理解重于匹配。" - 项目原则_
